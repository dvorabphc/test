---
title: "Complaints Plot"
author: "Dollar Vora"
date: "April 13, 2017"
output: 
  html_document: 
    keep_md: yes
---

![](http://www.legityoga.org/uploads/5/4/9/6/54961513/bphc_orig.png)


####Loading the libraries
```{r setup, include=FALSE}
library(RODBC)
library(plotly)
library(magrittr)
```

####Querying the data from the DB and storing in a dataframe
```{r}
synddb <- odbcConnect("Syndromic", uid="BPHCAD/your_username", pwd="your_pwd", believeNRows=FALSE)
totalcomplaints<-sqlQuery(synddb,"select c.siteid,count(c.siteid) number_of_complaints, s.sitefullname from complainttmp c, site s
                          where s.siteid= c.siteid and c.siteid in(1,2,3,4,5,6,7,8, 10,11,19,20)
                          group by c.siteid,s.sitefullname
                          order by c.siteid asc")
```
####Snippet of the dataframe
```{r}
totalcomplaints
```

####Plotting the data on a pie chart __*(hover over the pie for number of compaints)*__
```{r}
plottest <- plot_ly(totalcomplaints,labels=paste(totalcomplaints$sitefullname,totalcomplaints$siteid,sep = "-"),values = ~number_of_complaints, type = 'pie',
                textposition = 'inside',
                textinfo = 'label+percent+values',
                insidetextfont = list(color = '#FFFFFF'),
                hoverinfo = 'text',
                text = ~paste( number_of_complaints, 'complaints'),
                marker = list(colors = colors,
                              line = list(color = '#000000', width = 1)),
                showlegend = T) %>%
  layout(title = 'Complaints in Percentage',
         xaxis = list(showgrid = FALSE, zeroline = FALSE, showticklabels = FALSE),
         yaxis = list(showgrid = FALSE, zeroline = FALSE, showticklabels = FALSE))

plottest
```